version: '4'

services:
  api-gateway:
    platform: linux/amd64
    build:
      context: ./Gateway
      target: prod
    restart: unless-stopped
    environment:
      PORT: $GATEWAY_PORT
      USERSMS_HOST: $USERSMS_HOST
      USERSMS_PORT: $USERSMS_PORT
    ports:
      - 3000:$GATEWAY_PORT
    networks:
      - microservices-network

  usersms:
    platform: linux/amd64
    build:
      context: ./UsersMS
      target: prod
    hostname: $USERSMS_HOST
    restart: unless-stopped
    environment:
      PORT: $USERSMS_PORT
      HEALTHCHECK_PORT: $USERSMS_HEALTHCHECK_PORT
    ports:
      - 3001:$USERSMS_HEALTHCHECK_PORT
    networks:
      - microservices-network

networks:
  microservices-network:
    driver: bridge